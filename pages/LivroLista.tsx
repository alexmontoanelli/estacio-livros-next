import { LinhaLivro } from '@/componentes/LinhaLivro';
import { Menu } from '@/componentes/Menu';
import type {NextPage} from 'next';
import Head from 'next/head';
import React, { useEffect, useState } from 'react';
import styles from '../styles/Home.module.css'




const baseUrl = 'http://localhost:3000/api/livros'




async function obter() {

    return fetch(baseUrl).then((r) => r.json());

}



const LivroLista : NextPage = () => {

    const [livros, setLivros] = useState([]);
    let [carregado, setCarregado] = useState(false);

    function excluirLivro(codigo : number){


        return fetch(baseUrl + '/' + codigo, {method: 'DELETE'}).then((e) => {
            setCarregado(false);
            return e.body;
        })
    
    }

    useEffect(() => {
        if (carregado == false){
            setCarregado(true);
            obter().then((data) => {
                setLivros(data);
            });
        }
    });

    return (
        <div className={styles.container}>
      <Head>
        <title>Loja Next</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Menu />
        <h1 className={styles.title}>Cat√°logo</h1>
        <main className={styles.main}>
        <table className="table">
                <thead className="table-dark">
                    <tr>
                        <th>Titulo</th>
                        <th>Resumo</th>
                        <th>Editora</th>
                        <th>Autores</th>
                    </tr>
                </thead>
                <tbody className="table-group-divider">
                {livros.map((item, index)=>{
                    return <LinhaLivro key={index} livro={item} excluir={excluirLivro}></LinhaLivro>
                })}
                </tbody>   
            </table> 
        </main>
    </div>
    )
}

export default LivroLista;